<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Perfil - Congregação Nyan</title>

  <link rel="stylesheet" href="./src/css/membro.css">
  <link rel="stylesheet" href="./src/css/medias.css">

</head>

<body>
  <button onclick="voltarComReload()" class="voltar">Voltar</button>

  <section class="secao esquerda1">
    <div class="conteudo esquerda1">
      <h1 id="nome"></h1>
      <p id="frase"></p>
      <p id="sobre"></p>
    </div>
  </section>

  <section class="secao direita1">
    <div class="conteudo direita1">
      <h2>Jogos mais jogados</h2>
      <div id="jogos-container" class="cards">
      </div>
    </div>
  </section>

  <section class="secao esquerda2">
    <div class="conteudo esquerda2">
      <h2>Redes</h2>
      <div class="redes">
        <a id="link-twitch" class="btn twitch" target="_blank">Twitch</a>
        <a id="link-discord" class="btn discord" target="_blank">Discord</a>
        <a id="link-insta" class="btn insta" target="_blank">Instagram</a>
      </div>
    </div>
  </section>

  <section class="secao direita2">
    <div class="conteudo direita2">
      <h2>Clipes & Momentos</h2>
      <div class="embed" id="clips-container">
      </div>
    </div>
  </section>
  <script src="./src/script.js"></script>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const nomeMembro = urlParams.get('membro');

    // Fallback: verifica se o objeto de dados e o membro existem
    if (!nomeMembro || !window.MEMBROS || !window.MEMBROS[nomeMembro]) {
      // Redireciona se o membro não for encontrado
      console.error('Membro não encontrado ou MEMBROS não carregado.');
      window.location.href = 'index.html';
    }

    const membro = window.MEMBROS[nomeMembro];

    // Mapeia todas as variáveis a partir do objeto 'membro'
    const {
      twitch,
      frase,
      cor,
      sobre,
      discord,
      instagram,
      fundoSecao1,
      fundoSecao2,
      fundoSecao3,
      fundoSecao4,
      jogos, // Lista de objetos de jogos
      clips  // Lista de objetos de clipes
    } = membro;

    // A. APLICA CONTEÚDO E LINKS (Dados textuais)
    document.getElementById('nome').textContent = nomeMembro;
    document.getElementById('frase').textContent = `"${frase}"`;
    document.getElementById('sobre').textContent = sobre;
    document.getElementById('link-twitch').href = `https://twitch.tv/${twitch}`;
    document.getElementById('link-discord').href = discord;
    document.getElementById('link-insta').href = instagram;

    // ----------------------------------------------------------------------
    // B. APLICA OS FUNDOS 
    // ----------------------------------------------------------------------
    const aplicarFundo = (seletor, fundo) => {
      if (fundo) {
        document.querySelector(seletor).style.background = `url('./src/assets/${fundo}') center/cover no-repeat`;
      }
    };

    aplicarFundo('.secao.esquerda1', fundoSecao1);
    aplicarFundo('.secao.direita1', fundoSecao2);
    aplicarFundo('.secao.esquerda2', fundoSecao3);
    aplicarFundo('.secao.direita2', fundoSecao4);


    // ----------------------------------------------------------------------
    // C. GERA OS CARDS DE JOGOS DINAMICAMENTE
    // ----------------------------------------------------------------------
    const containerJogos = document.querySelector('.secao.direita1 .cards');

    if (jogos && containerJogos) {
      containerJogos.innerHTML = ''; // Limpa os cards fixos do HTML

      jogos.forEach(jogo => {
        const cardDiv = document.createElement('div');
        cardDiv.className = 'card';

        // Aplica o fundo do jogo (se existir)
        if (jogo.fundo) {
          cardDiv.style.background = `url('./src/assets/${jogo.fundo}') center/cover no-repeat`;
          cardDiv.style.backgroundSize = 'cover';
          cardDiv.style.position = 'relative';
          cardDiv.style.color = '#fff'; // Ajusta a cor do texto, se necessário
        }

        const h3 = document.createElement('h3');
        h3.textContent = jogo.nome;

        cardDiv.appendChild(h3);
        containerJogos.appendChild(cardDiv);
      });
    }

    // ----------------------------------------------------------------------
    // D. NOVO: GERA O(S) IFRAME(S) DOS CLIPES DINAMICAMENTE
    // ----------------------------------------------------------------------
    const containerClipes = document.getElementById('clips-container');

    if (clips && containerClipes) {
      containerClipes.innerHTML = ''; // Limpa o iframe fixo do HTML

      // Define o 'parent' necessário pelo Twitch (o domínio/host do seu site)
      const parentDomain = window.location.hostname;

      clips.forEach(clip => {
        // URL de embed para clipes: https://clips.twitch.tv/embed?clip=<CLIP_SLUG>&parent=<YOUR_DOMAIN>
        const clipUrl = `https://clips.twitch.tv/embed?clip=${clip.slug}&parent=${parentDomain}`;

        const iframe = document.createElement('iframe');
        iframe.src = clipUrl;
        iframe.title = clip.titulo || 'Twitch Clip';
        iframe.width = '100%';
        iframe.height = '225'; // Altura definida no CSS (membro.css/medias.css)
        iframe.allowFullscreen = true;
        iframe.frameBorder = 0;
        iframe.scrolling = 'no';

        containerClipes.appendChild(iframe);

        // Adiciona uma margem inferior para separar clipes, se houver mais de um
        if (clips.length > 1) {
          iframe.style.marginBottom = '20px';
        }
      });
    }

  </script>
</body>

</html>